!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TomSelect=e()}(this,function(){"use strict";function t(t,e){t.split(/\s+/).forEach(t=>{e(t)})}class e{constructor(){this._events={}}on(e,i){t(e,t=>{this._events[t]=this._events[t]||[],this._events[t].push(i)})}off(e,i){var s=arguments.length;0!==s?t(e,t=>{if(1===s)return delete this._events[t];t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(i),1)}):this._events={}}trigger(e,...i){var s=this;t(e,t=>{if(t in s._events!=!1)for(let e of s._events[t])e.apply(s,i)})}}var i=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:t<e?-1:0:(t=r(String(t||"")))>(e=r(String(e||"")))?1:e>t?-1:0},s=function(t,e,i){if(t&&e){if(!i)return t[e];for(var s=e.split(".");s.length&&(t=t[s.shift()]););return t}},n=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},o={a:"[aá¸€á¸Ä‚ÄƒÃ‚Ã¢ÇÇÈºâ±¥È¦È§áº áº¡Ã„Ã¤Ã€Ã ÃÃ¡Ä€ÄÃƒÃ£Ã…Ã¥Ä…Ä„ÃƒÄ…Ä„]",b:"[bâ¢Î²Î’Bà¸¿ğŒá›’]",c:"[cÄ†Ä‡ÄˆÄ‰ÄŒÄÄŠÄ‹CÌ„cÌ„Ã‡Ã§á¸ˆá¸‰È»È¼Æ‡ÆˆÉ•á´„ï¼£ï½ƒ]",d:"[dÄÄá¸Šá¸‹á¸á¸‘á¸Œá¸á¸’á¸“á¸á¸ÄÄ‘DÌ¦dÌ¦Æ‰É–ÆŠÉ—Æ‹ÆŒáµ­á¶á¶‘È¡á´…ï¼¤ï½„Ã°]",e:"[eÃ‰Ã©ÃˆÃ¨ÃŠÃªá¸˜á¸™ÄšÄ›Ä”Ä•áº¼áº½á¸šá¸›áººáº»Ä–Ä—Ã‹Ã«Ä’Ä“È¨È©Ä˜Ä™á¶’É†É‡È„È…áº¾áº¿á»€á»á»„á»…á»‚á»ƒá¸œá¸á¸–á¸—á¸”á¸•È†È‡áº¸áº¹á»†á»‡â±¸á´‡ï¼¥ï½…É˜ÇÆÆÎµ]",f:"[fÆ‘Æ’á¸á¸Ÿ]",g:"[gÉ¢â‚²Ç¤Ç¥ÄœÄÄÄŸÄ¢Ä£Æ“É Ä Ä¡]",h:"[hÄ¤Ä¥Ä¦Ä§á¸¨á¸©áº–áº–á¸¤á¸¥á¸¢á¸£É¦Ê°Ç¶Æ•]",i:"[iÃÃ­ÃŒÃ¬Ä¬Ä­ÃÃ®ÇÇÃÃ¯á¸®á¸¯Ä¨Ä©Ä®Ä¯ÄªÄ«á»ˆá»‰ÈˆÈ‰ÈŠÈ‹á»Šá»‹á¸¬á¸­Æ—É¨É¨Ì†áµ»á¶–Ä°iIÄ±Éªï¼©ï½‰]",j:"[jÈ·Ä´ÄµÉˆÉ‰ÊÉŸÊ²]",k:"[kÆ˜Æ™ê€êá¸°á¸±Ç¨Ç©á¸²á¸³á¸´á¸µÎºÏ°â‚­]",l:"[lÅÅ‚Ä½Ä¾Ä»Ä¼Ä¹Äºá¸¶á¸·á¸¸á¸¹á¸¼á¸½á¸ºá¸»Ä¿Å€È½Æšâ± â±¡â±¢É«É¬á¶…É­È´ÊŸï¼¬ï½Œ]",n:"[nÅƒÅ„Ç¸Ç¹Å‡ÅˆÃ‘Ã±á¹„á¹…Å…Å†á¹†á¹‡á¹Šá¹‹á¹ˆá¹‰NÌˆnÌˆÆÉ²È Æáµ°á¶‡É³ÈµÉ´ï¼®ï½ÅŠÅ‹]",o:"[oÃ˜Ã¸Ã–Ã¶Ã“Ã³Ã’Ã²Ã”Ã´Ç‘Ç’ÅÅ‘ÅÅÈ®È¯á»Œá»ÆŸÉµÆ Æ¡á»á»ÅŒÅÃ•ÃµÇªÇ«ÈŒÈÕ•Ö…]",p:"[pá¹”á¹•á¹–á¹—â±£áµ½Æ¤Æ¥áµ±]",q:"[qê–ê—Ê ÉŠÉ‹ê˜ê™qÌƒ]",r:"[rÅ”Å•ÉŒÉÅ˜Å™Å–Å—á¹˜á¹™ÈÈ‘È’È“á¹šá¹›â±¤É½]",s:"[sÅšÅ›á¹ á¹¡á¹¢á¹£ê¨ê©ÅœÅÅ Å¡ÅÅŸÈ˜È™SÌˆsÌˆ]",t:"[tÅ¤Å¥á¹ªá¹«Å¢Å£á¹¬á¹­Æ®ÊˆÈšÈ›á¹°á¹±á¹®á¹¯Æ¬Æ­]",u:"[uÅ¬Å­É„Ê‰á»¤á»¥ÃœÃ¼ÃšÃºÃ™Ã¹Ã›Ã»Ç“Ç”Å°Å±Å¬Å­Æ¯Æ°á»¦á»§ÅªÅ«Å¨Å©Å²Å³È”È•âˆª]",v:"[vá¹¼á¹½á¹¾á¹¿Æ²Ê‹êêŸâ±±Ê‹]",w:"[wáº‚áºƒáº€áºÅ´Åµáº„áº…áº†áº‡áºˆáº‰]",x:"[xáºŒáºáºŠáº‹Ï‡]",y:"[yÃÃ½á»²á»³Å¶Å·Å¸Ã¿á»¸á»¹áºáºá»´á»µÉÉÆ³Æ´]",z:"[zÅ¹Åºáºáº‘Å½Å¾Å»Å¼áº’áº“áº”áº•ÆµÆ¶]"},r=function(){var t,e,i,s,n="",r={};for(i in o)if(o.hasOwnProperty(i))for(n+=s=o[i].substring(2,o[i].length-1),t=0,e=s.length;t<e;t++)r[s.charAt(t)]=i;var a=new RegExp("["+n+"]","g");return function(t){return t.replace(a,function(t){return r[t]}).toLowerCase()}}();class a{constructor(t,e){this.items=void 0,this.settings=void 0,this.items=t,this.settings=e||{diacritics:!0}}tokenize(t,e){if(!(t=String(t||"").toLowerCase().trim())||!t.length)return[];var i,s,r,a,l=[],h=t.split(/ +/);for(i=0,s=h.length;i<s;i++){if(r=n(h[i]),this.settings.diacritics)for(a in o)o.hasOwnProperty(a)&&(r=r.replace(new RegExp(a,"g"),o[a]));e&&(r="\\b"+r),l.push({string:h[i],regex:new RegExp(r,"i")})}return l}iterator(t,e){(Array.isArray(t)?Array.prototype.forEach||function(t){for(var e=0,i=this.length;e<i;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)}).apply(t,[e])}getScoreFunction(t,e){var i,n,o,r,a;a=this.prepareSearch(t,e),n=a.tokens,i=a.options.fields,o=n.length,r=a.options.nesting;var l,h=function(t,e){var i,s;return t?-1===(s=(t=String(t||"")).search(e.regex))?0:(i=e.string.length/t.length,0===s&&(i+=.5),i):0},d=(l=i.length)?1===l?function(t,e){return h(s(e,i[0],r),t)}:function(t,e){for(var n=0,o=0;n<l;n++)o+=h(s(e,i[n],r),t);return o/l}:function(){return 0};return o?1===o?function(t){return d(n[0],t)}:"and"===a.options.conjunction?function(t){for(var e,i=0,s=0;i<o;i++){if((e=d(n[i],t))<=0)return 0;s+=e}return s/o}:function(t){for(var e=0,i=0;e<o;e++)i+=d(n[e],t);return i/o}:function(){return 0}}getSortFunction(t,e){var n,o,r,a,l,h,d,p,c,u,g;if(g=!(t=(r=this).prepareSearch(t,e)).query&&e.sort_empty||e.sort,c=function(t,i){return"$score"===t?i.score:s(r.items[i.id],t,e.nesting)},l=[],g)for(n=0,o=g.length;n<o;n++)(t.query||"$score"!==g[n].field)&&l.push(g[n]);if(t.query){for(u=!0,n=0,o=l.length;n<o;n++)if("$score"===l[n].field){u=!1;break}u&&l.unshift({field:"$score",direction:"desc"})}else for(n=0,o=l.length;n<o;n++)if("$score"===l[n].field){l.splice(n,1);break}for(p=[],n=0,o=l.length;n<o;n++)p.push("desc"===l[n].direction?-1:1);return(h=l.length)?1===h?(a=l[0].field,d=p[0],function(t,e){return d*i(c(a,t),c(a,e))}):function(t,e){var s,n,o;for(s=0;s<h;s++)if(o=l[s].field,n=p[s]*i(c(o,t),c(o,e)))return n;return 0}:null}prepareSearch(t,e){if("object"==typeof t)return t;var i=(e=Object.assign({},e)).fields,s=e.sort,n=e.sort_empty;return i&&!Array.isArray(i)&&(e.fields=[i]),s&&!Array.isArray(s)&&(e.sort=[s]),n&&!Array.isArray(n)&&(e.sort_empty=[n]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t,e.respect_word_boundaries),total:0,items:[]}}search(t,e){var i,s,n,o;return s=this.prepareSearch(t,e),e=s.options,t=s.query,o=e.score||this.getScoreFunction(s),t.length?this.iterator(this.items,function(t,n){i=o(t),(!1===e.filter||i>0)&&s.items.push({score:i,id:n})}):this.iterator(this.items,function(t,e){s.items.push({score:1,id:e})}),(n=this.getSortFunction(s,e))&&s.items.sort(n),s.total=s.items.length,"number"==typeof e.limit&&(s.items=s.items.slice(0,e.limit)),s}}function l(t,e){if("string"!=typeof e||e.length){var i="string"==typeof e?new RegExp(e,"i"):e;!function t(e){var s=0;if(3===e.nodeType){var n=e.data.search(i);if(n>=0&&e.data.length>0){var o=e.data.match(i),r=document.createElement("span");r.className="highlight";var a=e.splitText(n);a.splitText(o[0].length);var l=a.cloneNode(!0);r.appendChild(l),a.parentNode.replaceChild(r,a),s=1}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&("highlight"!==e.className||"SPAN"!==e.tagName))for(var h=0;h<e.childNodes.length;++h)h+=t(e.childNodes[h]);return s}(t)}}const h=65,d=13,p=27,c=37,u=38,g=39,f=40,v=8,m=46,y=9,O="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var b={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,closeAfterSelect:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-control",inputClass:"ts-input",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:null,copyClassesToDropdown:!0,placeholder:null,hidePlaceholder:null,shouldLoad:function(t){return t.length>0},render:{}};function w(t){return null==t?null:"boolean"==typeof t?t?"1":"0":t+""}function I(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function C(t,e,i){var s,n=t.trigger,o={};for(s in t.trigger=function(){var i=arguments[0];if(-1===e.indexOf(i))return n.apply(t,arguments);o[i]=arguments},i.apply(t,[]),t.trigger=n,o)n.apply(t,o[s])}function _(t,e=!1){t&&(t.preventDefault(),e&&t.stopPropagation())}function A(t,e,i,s){t.addEventListener(e,i,s)}function S(t,e){return!!e&&(!!e[t]&&1===(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0))}function x(t,e){const i=t.getAttribute("id");return i||(t.setAttribute("id",e),e)}function k(t,e){var i=Object.assign({},b,e),s=i.dataAttr,n=i.labelField,o=i.valueField,r=i.disabledField,a=i.optgroupField,l=i.optgroupLabelField,h=i.optgroupValueField,d=t.tagName.toLowerCase(),p=t.getAttribute("placeholder")||t.getAttribute("data-placeholder");if(!p&&!i.allowEmptyOption){let e=t.querySelector('option[value=""]');e&&(p=e.textContent)}var c={placeholder:p,options:[],optgroups:[],items:[],maxItems:null};return"select"===d?(()=>{var e,d=c.options,p={},u=1,g=t=>{var e=Object.assign({},t.dataset),i=s&&e[s];return"string"==typeof i&&i.length&&(e=Object.assign(e,JSON.parse(i))),e},f=(t,e)=>{var s=w(t.value);if(s||i.allowEmptyOption)if(p.hasOwnProperty(s)){if(e){var l=p[s][a];l?Array.isArray(l)?l.push(e):p[s][a]=[l,e]:p[s][a]=e}}else{var h=g(t);h[n]=h[n]||t.textContent,h[o]=h[o]||s,h[r]=h[r]||t.disabled,h[a]=h[a]||e,h.$option=t,p[s]=h,d.push(h),t.selected&&c.items.push(s)}},v=t=>{var e,i;(i=g(t))[l]=i[l]||t.getAttribute("label")||"",i[h]=i[h]||u++,i[r]=i[r]||t.disabled,c.optgroups.push(i),e=i[h];for(const i of t.children)f(i,e)};c.maxItems=t.hasAttribute("multiple")?null:1;for(const i of t.children)"optgroup"===(e=i.tagName.toLowerCase())?v(i):"option"===e&&f(i)})():(()=>{var e,r,a=t.getAttribute(s);if(a){c.options=JSON.parse(a);for(const t of c.options)c.items.push(t[o])}else{var l=t.value.trim()||"";if(!i.allowEmptyOption&&!l.length)return;e=l.split(i.delimiter);for(const t of e)(r={})[n]=t,r[o]=t,c.options.push(r);c.items=e}})(),Object.assign({},b,c,e)}function F(t){if(t.jquery)return t[0];if(t instanceof HTMLElement)return t;if(t.indexOf("<")>-1){let e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}return document.querySelector(t)}function L(t,e){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!1),t.dispatchEvent(i)}function P(t,e){Object.assign(t.style,e)}function E(t,...e){var i=q(e);(t=V(t)).map(t=>{i.map(e=>{t.classList.add(e)})})}function T(t,...e){var i=q(e);(t=V(t)).map(t=>{i.map(e=>{t.classList.remove(e)})})}function q(t){var e=[];for(let i of t)"string"==typeof i&&(i=i.trim().split(/[\11\12\14\15\40]/)),Array.isArray(i)&&(e=e.concat(i));return e.filter(Boolean)}function V(t){return Array.isArray(t)||(t=[t]),t}function j(t,e,i){if(!i||i.contains(t))for(;t&&t.matches;){if(t.matches(e))return t;t=t.parentNode}}function D(t,e){return e>0?t[t.length-1]:t[0]}function N(t,e){if(!t)return-1;e=e||t.nodeName;for(var i=0;t=t.previousElementSibling;)t.matches(e)&&i++;return i}function R(t,e){for(const i in e)t.setAttribute(i,e[i])}var B=0;class H extends(function(t){return t.plugins={},class extends t{static define(e,i){t.plugins[e]={name:e,fn:i}}initializePlugins(t){var e,i,s,n=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},Array.isArray(t))for(e=0,i=t.length;e<i;e++)"string"==typeof t[e]?n.push(t[e]):(this.plugins.settings[t[e].name]=t[e].options,n.push(t[e].name));else if(t)for(s in t)t.hasOwnProperty(s)&&(this.plugins.settings[s]=t[s],n.push(s));for(;n.length;)this.require(n.shift())}loadPlugin(e){var i=this.plugins,s=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=s.fn.apply(this,[this.plugins.settings[e]||{}]),i.names.push(e)}require(t){var e=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(e.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return e.loaded[t]}}}(e)){constructor(t,e){var i;super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.tab_key=!1,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreBlur=!1,this.hasOptions=!1,this.currentResults=null,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.options_i=0,this.userOptions={},this.items=[],this.renderCache={item:{},option:{}},B++;var s,n,o,r=F(t);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this,i=(window.getComputedStyle&&window.getComputedStyle(r,null)).getPropertyValue("direction"),this.settings=k(r,e),this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag="select"===r.tagName.toLowerCase(),this.rtl=/rtl/i.test(i),this.inputId=x(r,"tomselect-"+B),this.isRequired=r.required,this.settings.load&&this.settings.loadThrottle&&(this.settings.load=(s=this.settings.load,n=this.settings.loadThrottle,function(t,e){var i=this;o&&(i.loading=Math.max(i.loading-1,0)),clearTimeout(o),o=setTimeout(function(){o=null,i.loadedSearches[t]=!0,s.call(i,t,e)},n)})),this.sifter=new a(this.options,{diacritics:this.settings.diacritics}),this.setupOptions(this.settings.options,this.settings.optgroups),delete this.settings.optgroups,delete this.settings.options,this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode),"boolean"!=typeof this.settings.hidePlaceholder&&(this.settings.hidePlaceholder="multi"!==this.settings.mode);var l=this.settings.createFilter;"function"!=typeof l&&("string"==typeof l&&(l=new RegExp(l)),l instanceof RegExp?this.settings.createFilter=(t=>l.test(t)):this.settings.createFilter=(()=>!0)),this.initializePlugins(this.settings.plugins),this.setupCallbacks(),this.setupTemplates(),this.setup()}setup(){var t,e,i,s,n,o,r,a,l,h=this,d=h.settings,p=h.input;const c={passive:!0},u=h.inputId+"-ts-dropdown";if(o=h.settings.mode,r=p.getAttribute("class")||"",E(t=F("<div>"),d.wrapperClass,r,o),E(e=F('<div class="items">'),d.inputClass),t.append(e),E(s=h.render("dropdown"),d.dropdownClass,o),E(n=F(`<div role="listbox" id="${u}" tabindex="-1">`),d.dropdownContentClass),s.append(n),F(d.dropdownParent||t).appendChild(s),d.controlInput)i=F(d.controlInput);else{i=F('<input type="text" autocomplete="off" size="1" />');for(const t of["autocorrect","autocapitalize","autocomplete"])p.getAttribute(t)&&R(i,{[t]:p.getAttribute(t)})}d.controlInput||(i.tabIndex=p.disabled?-1:h.tabIndex,e.appendChild(i)),R(i,{role:"combobox",haspopup:"listbox","aria-expanded":"false","aria-controls":u}),l=x(i,h.inputId+"-tomselected");let g="label[for='"+function(t){return t.replace(/['"\\]/g,"\\$&")}(h.inputId)+"']",f=document.querySelector(g);if(f){R(f,{for:l}),R(n,{"aria-labelledby":x(f,h.inputId+"-ts-label")})}if(h.settings.copyClassesToDropdown&&E(s,r),t.style.width=p.style.width,h.plugins.names.length&&(a="plugin-"+h.plugins.names.join(" plugin-"),E([t,s],a)),(null===d.maxItems||d.maxItems>1)&&h.is_select_tag&&R(p,{multiple:"multiple"}),h.settings.placeholder&&R(i,{placeholder:d.placeholder}),!h.settings.splitOn&&h.settings.delimiter){var v=h.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");h.settings.splitOn=new RegExp("\\s*"+v+"+\\s*")}h.control=e,h.control_input=i,h.wrapper=t,h.dropdown=s,h.dropdown_content=n,h.control_input.type=p.type,A(s,"mouseenter",t=>{var e=j(t.target,"[data-selectable]",s);if(e)return h.onOptionHover(t,e)},{capture:!0}),A(e,"mousedown",t=>{if(t.target==i)return h.clearActiveItems(),t.stopPropagation(),void h.inputState();var s=j(t.target,"."+h.settings.itemClass,e);return s?h.onItemSelect(t,s):h.onMouseDown(t)}),A(e,"click",t=>h.onClick(t)),A(i,"keydown",t=>h.onKeyDown(t)),A(i,"keyup",t=>h.onKeyUp(t)),A(i,"keypress",t=>h.onKeyPress(t)),A(i,"resize",()=>h.positionDropdown(),c),A(i,"blur",t=>h.onBlur(t)),A(i,"focus",t=>{h.ignoreBlur=!1,h.onFocus(t)}),A(i,"paste",t=>h.onPaste(t));var m=t=>{var e=j(t.target,"[data-selectable]",h.dropdown);if(!e&&!h.wrapper.contains(t.target))return h.isFocused&&h.blur(),void h.inputState();_(t,!0),e&&h.onOptionSelect(t,e)},y=()=>{h.isOpen&&h.positionDropdown()};A(document,"mousedown",m),A(window,"sroll",y,c),A(window,"resize",y,c),h._destroy=(()=>{document.removeEventListener("mousedown",m),window.removeEventListener("sroll",y),window.removeEventListener("resize",y)}),this.revertSettings={innerHTML:p.innerHTML,tabIndex:p.tabIndex},p.tabIndex=-1,R(p,{hidden:"hidden"}),p.insertAdjacentElement("afterend",h.wrapper),h.setValue(d.items),delete d.items,A(p,"invalid",t=>{_(t),h.isInvalid||(h.isInvalid=!0,h.refreshState())}),h.updateOriginalInput(),h.refreshItems(),h.refreshState(),h.inputState(),h.isSetup=!0,p.disabled&&h.disable(),h.on("change",this.onChange),E(p,"tomselected"),h.trigger("initialize"),!0===d.preload&&h.load("")}setupOptions(t=[],e=[]){for(const e of t)this.registerOption(e);for(const t of e)this.registerOptionGroup(t)}setupTemplates(){var t=this.settings.labelField,e=this.settings.optgroupLabelField,i={optgroup:(t,e)=>{let i=document.createElement("div");return i.className="optgroup",i.appendChild(t.options),i},optgroup_header:(t,i)=>'<div class="optgroup-header">'+i(t[e])+"</div>",option:(e,i)=>"<div>"+i(e[t])+"</div>",item:(e,i)=>"<div>"+i(e[t])+"</div>",option_create:(t,e)=>'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>",no_results:(t,e)=>'<div class="no-results">No results found</div>',loading:(t,e)=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};this.settings.render=Object.assign({},i,this.settings.render)}setupCallbacks(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in i)(e=this.settings[i[t]])&&this.on(t,e)}onClick(t){this.isFocused&&this.isOpen||(this.focus(),_(t))}onMouseDown(t){var e=this;if(e.isFocused)return"single"!==e.settings.mode&&e.setActiveItem(),e.open(),!1;setTimeout(()=>e.focus(),0)}onChange(){L(this.input,"input"),L(this.input,"change")}onPaste(t){var e=this;e.isFull()||e.isInputHidden||e.isLocked?_(t):e.settings.splitOn&&setTimeout(()=>{var t=e.inputValue();if(t.match(e.settings.splitOn)){var i=t.trim().split(e.settings.splitOn);for(const t of i)e.createItem(t)}},0)}onKeyPress(t){if(!this.isLocked){var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),void _(t)):void 0}_(t)}onKeyDown(t){if(this.isLocked)t.keyCode!==y&&_(t);else{switch(t.keyCode){case h:if(S(O,t))return void this.selectAll();break;case p:return this.isOpen&&(_(t,!0),this.close()),void this.clearActiveItems();case f:if(!this.isOpen&&this.hasOptions)this.open();else if(this.activeOption){let t=this.getAdjacent(this.activeOption,1);t&&this.setActiveOption(t)}return void _(t);case u:if(this.activeOption){let t=this.getAdjacent(this.activeOption,-1);t&&this.setActiveOption(t)}return void _(t);case d:return void(this.isOpen&&this.activeOption&&(this.onOptionSelect(t,this.activeOption),_(t)));case c:return void this.advanceSelection(-1,t);case g:return void this.advanceSelection(1,t);case y:return this.settings.selectOnTab&&this.isOpen&&this.activeOption&&(this.tab_key=!0,this.onOptionSelect(t,this.activeOption),_(t),this.tab_key=!1),void(this.settings.create&&this.createItem()&&_(t));case v:case m:return void this.deleteSelection(t)}this.isInputHidden&&!S(O,t)&&_(t)}}onKeyUp(t){if(this.isLocked)_(t);else{var e=this.inputValue();this.lastValue!==e&&(this.lastValue=e,this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e))}}onFocus(t){var e=this.isFocused;if(this.isDisabled)return this.blur(),void _(t);this.ignoreFocus||(this.isFocused=!0,"focus"===this.settings.preload&&this.load(""),e||this.trigger("focus"),this.activeItems.length||(this.showInput(),this.setActiveItem(),this.refreshOptions(!!this.settings.openOnFocus)),this.refreshState())}onBlur(t){var e=this;if(e.isFocused){if(e.isFocused=!1,e.ignoreFocus=!1,!e.ignoreBlur&&document.activeElement===e.dropdown_content)return e.ignoreBlur=!0,void e.onFocus(t);var i=()=>{e.close(),e.setActiveItem(),e.setCaret(e.items.length),e.trigger("blur")};e.settings.create&&e.settings.createOnBlur?e.createItem(null,!1,i):i()}}onOptionHover(t,e){}onOptionSelect(t,e){var i,s=this;e&&(e.parentElement&&e.parentElement.matches("[data-disabled]")||(e.classList.contains("create")?s.createItem(null,!0,()=>{s.settings.closeAfterSelect&&s.close()}):void 0!==(i=e.dataset.value)&&(s.lastQuery=null,s.addItem(i),s.settings.closeAfterSelect?s.close():!s.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&s.setActiveOption(s.getOption(i)))))}onItemSelect(t,e){this.isLocked||"multi"===this.settings.mode&&(_(t),this.setActiveItem(e,t))}load(t){var e=this,i=e.settings.load;i&&(e.loadedSearches.hasOwnProperty(t)||(E(e.wrapper,e.settings.loadingClass),e.loading++,i.call(e,t,function(t,i){e.loading=Math.max(e.loading-1,0),e.lastQuery=null,e.clearActiveOption(),e.setupOptions(t,i),e.refreshOptions(e.isFocused&&!e.isInputHidden),e.loading||T(e.wrapper,e.settings.loadingClass),e.trigger("load",t,i)})))}onSearchChange(t){this.load(t)}setTextboxValue(t=""){var e=this.control_input;e.value!==t&&(e.value=t,L(e,"update"),this.lastValue=t)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(t,e){C(this,e?[]:["change"],()=>{this.clear(e),this.addItems(t,e)})}setMaxItems(t){0===t&&(t=null),this.settings.maxItems=t,this.refreshState()}setActiveItem(t,e){var i,s,n,o,r,a;if("single"!==this.settings.mode){if(!t)return this.clearActiveItems(),void(this.isFocused&&this.showInput());if("mousedown"===(i=e&&e.type.toLowerCase())&&S("shiftKey",e)&&this.activeItems.length){for(a=this.getLastActive(),(n=Array.prototype.indexOf.call(this.control.children,a))>(o=Array.prototype.indexOf.call(this.control.children,t))&&(r=n,n=o,o=r),s=n;s<=o;s++)t=this.control.children[s],-1===this.activeItems.indexOf(t)&&this.setActiveItemClass(t);_(e)}else"mousedown"===i&&S(O,e)||"keydown"===i&&S("shiftKey",e)?t.classList.contains("active")?this.removeActiveItem(t):this.setActiveItemClass(t):(this.clearActiveItems(),this.setActiveItemClass(t));this.hideInput(),this.isFocused||this.focus()}}setActiveItemClass(t){var e=this.control.querySelector(".last-active");e&&T(e,"last-active"),E(t,"active last-active"),-1==this.activeItems.indexOf(t)&&this.activeItems.push(t)}removeActiveItem(t){var e=this.activeItems.indexOf(t);this.activeItems.splice(e,1),T(t,"active")}clearActiveItems(){T(this.activeItems,"active"),this.activeItems=[]}setActiveOption(t){var e,i,s;if(t===this.activeOption)return;if(this.clearActiveOption(),!t)return;this.activeOption=t,R(this.control_input,{"aria-activedescendant":t.getAttribute("id")}),R(t,{"aria-selected":"true"}),E(t,"active"),e=this.dropdown_content.clientHeight;let n=this.dropdown_content.scrollTop||0;i=this.activeOption.offsetHeight,(s=this.activeOption.getBoundingClientRect().top-this.dropdown_content.getBoundingClientRect().top+n)+i>e+n?this.dropdown_content.scrollTop=s-e+i:s<n&&(this.dropdown_content.scrollTop=s)}clearActiveOption(){this.activeOption&&(T(this.activeOption,"active"),this.activeOption.removeAttribute("aria-selected")),this.activeOption=null,this.control_input.removeAttribute("aria-activedescendant")}selectAll(){"single"!==this.settings.mode&&(this.activeItems=this.controlChildren(),this.activeItems.length&&(E(this.activeItems,"active"),this.hideInput(),this.close()),this.focus())}inputState(){this.settings.controlInput||(this.activeItems.length>0||!this.isFocused&&this.settings.hidePlaceholder&&this.items.length>0?(this.setTextboxValue(),this.isInputHidden=!0,E(this.wrapper,"input-hidden")):(this.isInputHidden=!1,T(this.wrapper,"input-hidden")))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.control_input.focus(),setTimeout(()=>{t.ignoreFocus=!1,t.onFocus()},0))}blur(){this.control_input.blur(),this.onBlur(null)}getScoreFunction(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())}getSearchOptions(){var t,e=this.settings;return"string"==typeof e.sortField&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(t){var e,i,s,n=this.settings,o=this.getSearchOptions();if(n.score&&"function"!=typeof(s=this.settings.score.call(this,t)))throw new Error('Tom Select "score" setting must be a function that returns a function');if(t!==this.lastQuery?(this.lastQuery=t,i=this.sifter.search(t,Object.assign(o,{score:s})),this.currentResults=i):i=Object.assign({},this.currentResults),n.hideSelected)for(e=i.items.length-1;e>=0;e--)-1!==this.items.indexOf(w(i.items[e].id))&&i.items.splice(e,1);return i}refreshOptions(t=!0){var e,i,s,n,o,r,a,h,d,p,c,u,g,f=this,v=f.inputValue(),m=f.search(v),y=f.activeOption&&w(f.activeOption.dataset.value),O=f.settings.shouldOpen||!1;for(n=m.items.length,"number"==typeof f.settings.maxOptions&&(n=Math.min(n,f.settings.maxOptions)),n>0&&(O=!0),u={},o=[],e=0;e<n;e++){let t=f.options[m.items[e].id],n=w(t[f.settings.valueField]),l=f.getOption(n);for(l||(l=f.render("option",t)),f.settings.hideSelected||l.classList.toggle("selected",f.items.includes(n)),r=t[f.settings.optgroupField]||"",i=0,s=(a=Array.isArray(r)?r:[r])&&a.length;i<s;i++)r=a[i],f.optgroups.hasOwnProperty(r)||(r=""),u.hasOwnProperty(r)||(u[r]=document.createDocumentFragment(),o.push(r)),i>0&&(T(l=l.cloneNode(!0),"active"),l.removeAttribute("aria-selected")),u[r].appendChild(l)}for(r of(this.settings.lockOptgroupOrder&&o.sort((t,e)=>{return(f.optgroups[t]&&f.optgroups[t].$order||0)-(f.optgroups[e]&&f.optgroups[e].$order||0)}),h=document.createDocumentFragment(),o))if(f.optgroups.hasOwnProperty(r)&&u[r].children.length){let t=document.createDocumentFragment();t.appendChild(f.render("optgroup_header",f.optgroups[r])),t.appendChild(u[r]);let e=f.render("optgroup",{group:f.optgroups[r],options:t});h.appendChild(e)}else h.appendChild(u[r]);if(f.dropdown_content.innerHTML="",f.dropdown_content.appendChild(h),f.settings.highlight&&(f.dropdown_content,g=document.querySelectorAll("span.highlight"),Array.prototype.forEach.call(g,function(t,e){var i=t.parentNode;i.replaceChild(t.firstChild,t),i.normalize()}),m.query.length&&m.tokens.length))for(const t of m.tokens)l(f.dropdown_content,t.regex);var b=t=>{let e=f.render(t,{input:v});return e&&(O=!0,f.dropdown_content.insertBefore(e,f.dropdown_content.firstChild)),e};if(f.settings.shouldLoad.call(f,v)?f.loading?b("loading"):0===m.items.length&&b("no_results"):b("not_loading"),(d=f.canCreate(v))&&(c=b("option_create")),f.hasOptions=m.items.length>0||d,O){if(m.items.length>0){if(!(p=y&&f.getOption(y))||!f.dropdown_content.contains(p)){let t=0;c&&!f.settings.addPrecedence&&(t=1),p=f.selectable()[t]}}else p=c;f.setActiveOption(p),t&&!f.isOpen&&f.open()}else f.clearActiveOption(),t&&f.isOpen&&f.close()}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(t){var e;if(Array.isArray(t))for(const e of t)this.addOption(e);else(e=this.registerOption(t))&&(this.userOptions[e]=!0,this.lastQuery=null,this.trigger("option_add",e,t))}registerOption(t){var e=w(t[this.settings.valueField]);return null!==e&&!this.options.hasOwnProperty(e)&&(t.$order=t.$order||++this.order,t.$id=this.inputId+"-opt-"+this.options_i++,this.options[e]=t,e)}registerOptionGroup(t){var e=w(t[this.settings.optgroupValueField]);return null!==e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)}addOptionGroup(t,e){var i;e[this.settings.optgroupValueField]=t,(i=this.registerOptionGroup(e))&&this.trigger("optgroup_add",i,e)}removeOptionGroup(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.clearCache(),this.trigger("optgroup_remove",t))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(t,e){var i,s,n,o,r,a,l;if(t=w(t),n=w(e[this.settings.valueField]),null!==t&&this.options.hasOwnProperty(t)){if("string"!=typeof n)throw new Error("Value must be set in option data");l=this.options[t].$order,n!==t&&(delete this.options[t],-1!==(o=this.items.indexOf(t))&&this.items.splice(o,1,n)),e.$order=e.$order||l,this.options[n]=e,r=this.renderCache.item,a=this.renderCache.option,r&&(delete r[t],delete r[n]),a&&(delete a[t],delete a[n]),-1!==this.items.indexOf(n)&&(i=this.getItem(t),s=this.render("item",e),i.classList.contains("active")&&E(s,"active"),i.parentNode.insertBefore(s,i),i.remove()),this.lastQuery=null,this.isOpen&&this.refreshOptions(!1)}}removeOption(t,e){t=w(t);var i=this.renderCache.item,s=this.renderCache.option;i&&delete i[t],s&&delete s[t],delete this.userOptions[t],delete this.options[t],this.lastQuery=null,this.trigger("option_remove",t),this.removeItem(t,e)}clearOptions(){this.loadedSearches={},this.userOptions={},this.clearCache();var t={};for(let e in this.options)this.options.hasOwnProperty(e)&&this.items.indexOf(e)>=0&&(t[e]=this.options[e]);this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}getOption(t){return this.renderCache.option.hasOwnProperty(t)?this.renderCache.option[t]:this.getElementWithValue(t,this.selectable())}getAdjacent(t,e,i="option"){var s;if(t){s="item"==i?this.controlChildren():this.dropdown_content.querySelectorAll("[data-selectable]");for(let i=0;i<s.length;i++)if(s[i]==t)return e>0?s[i+1]:s[i-1]}}getElementWithValue(t,e){if(null!==(t=w(t)))for(const i of e){let e=i;if(e.getAttribute("data-value")===t)return e}}getItem(t){return this.getElementWithValue(t,this.control.children)}addItems(t,e){var i=this;i.buffer=document.createDocumentFragment();for(const t of i.control.children)i.buffer.appendChild(t);var s=Array.isArray(t)?t:[t];for(let t=0,n=(s=s.filter(t=>-1===i.items.indexOf(t))).length;t<n;t++)i.isPending=t<n-1,i.addItem(s[t],e);var n=i.control;n.insertBefore(i.buffer,n.firstChild),i.buffer=null}addItem(t,e){C(this,e?[]:["change"],()=>{var i,s,n=this.settings.mode;if(t=w(t),(-1===this.items.indexOf(t)||("single"===n&&this.close(),"single"!==n&&this.settings.duplicates))&&this.options.hasOwnProperty(t)&&("single"===n&&this.clear(e),"multi"!==n||!this.isFull())){if(i=this.render("item",this.options[t]),this.control.contains(i)&&(i=i.cloneNode(!0)),s=this.isFull(),this.items.splice(this.caretPos,0,t),this.insertAtCaret(i),this.isSetup){let s=this.selectable();if(!this.isPending){let e=this.getOption(t),i=this.getAdjacent(e,1);this.refreshOptions(this.isFocused&&"single"!==n),i&&this.setActiveOption(i)}!s.length||this.isFull()?this.close():this.isPending||this.positionDropdown(),this.trigger("item_add",t,i),this.isPending||this.updateOriginalInput({silent:e})}(!this.isPending||!s&&this.isFull())&&this.refreshState()}})}removeItem(t,e){var i,s,n=this.getItem(t);n&&(t=w(n.dataset.value),-1!==(i=this.items.indexOf(t))&&(n.remove(),n.classList.contains("active")&&(s=this.activeItems.indexOf(n),this.activeItems.splice(s,1),T(n,"active")),this.items.splice(i,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(t)&&this.removeOption(t,e),i<this.caretPos&&this.setCaret(this.caretPos-1),this.updateOriginalInput({silent:e}),this.refreshState(),this.positionDropdown(),this.trigger("item_remove",t,n)))}createItem(t,e=!0,i){var s,n=this,o=n.caretPos;if(t=t||n.inputValue(),"function"!=typeof i&&(i=(()=>{})),!n.canCreate(t))return i(),!1;n.lock();var r=!1,a=t=>{if(n.unlock(),!t||"object"!=typeof t)return i();var s=w(t[n.settings.valueField]);if("string"!=typeof s)return i();n.setTextboxValue(),n.addOption(t),n.setCaret(o),n.addItem(s),n.refreshOptions(e&&"single"!==n.settings.mode),i(t),r=!0};return s="function"==typeof n.settings.create?n.settings.create.call(this,t,a):{[n.settings.labelField]:t,[n.settings.valueField]:t},r||a(s),!0}refreshItems(){this.lastQuery=null,this.isSetup&&this.addItems(this.items),this.updateOriginalInput(),this.refreshState()}refreshState(){this.refreshValidityState();var t=this.isFull(),e=this.isLocked;this.wrapper.classList.toggle("rtl",this.rtl);var i,s=this.control.classList;s.toggle("focus",this.isFocused),s.toggle("disabled",this.isDisabled),s.toggle("required",this.isRequired),s.toggle("invalid",this.isInvalid),s.toggle("locked",e),s.toggle("full",t),s.toggle("not-full",!t),s.toggle("input-active",this.isFocused&&!this.isInputHidden),s.toggle("dropdown-active",this.isOpen),s.toggle("has-options",(i=this.options,0===Object.keys(i).length)),s.toggle("has-items",this.items.length>0)}refreshValidityState(){if(this.input.checkValidity){this.isRequired&&(this.input.required=!0);var t=!this.input.checkValidity();this.isInvalid=t,this.control_input.required=t,this.isRequired&&(this.input.required=!t)}}isFull(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}updateOriginalInput(t={}){var e,i,s=this;if(s.is_select_tag)for(s.input.querySelectorAll("option[selected]").forEach(t=>{-1==s.items.indexOf(t.value)&&(t.selected=!1,t.removeAttribute("selected"))}),e=s.items.length-1;e>=0;e--){var n;if(i=s.items[e],!(n=s.options[i].$option)){const t=s.options[i][s.settings.labelField]||"";n=F('<option value="'+I(i)+'">'+I(t)+"</option>"),s.options[i].$option=n}n.selected=!0,R(n,{selected:"true"}),s.input.prepend(n)}else s.input.value=s.getValue();s.isSetup&&(t.silent||s.trigger("change",s.getValue()))}open(){this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.isOpen=!0,R(this.control_input,{"aria-expanded":"true"}),this.refreshState(),P(this.dropdown,{visibility:"hidden",display:"block"}),this.positionDropdown(),P(this.dropdown,{visibility:"visible",display:"block"}),this.focus(),this.trigger("dropdown_open",this.dropdown))}close(){var t=this.isOpen;this.setTextboxValue(),"single"===this.settings.mode&&this.items.length&&(this.hideInput(),this.tab_key||this.blur()),this.isOpen=!1,R(this.control_input,{"aria-expanded":"false"}),P(this.dropdown,{display:"none"}),this.clearActiveOption(),this.refreshState(),t&&this.trigger("dropdown_close",this.dropdown)}positionDropdown(){if("body"===this.settings.dropdownParent){var t=this.control,e=t.getBoundingClientRect(),i=t.offsetHeight+e.top+window.scrollY,s=e.left+window.scrollX;P(this.dropdown,{width:e.width+"px",top:i+"px",left:s+"px"})}}clear(t){if(this.items.length){var e=this.controlChildren();for(const t of e)t.remove();this.items=[],this.lastQuery=null,this.setCaret(0),this.setActiveItem(),this.updateOriginalInput({silent:t}),this.refreshState(),this.showInput(),this.trigger("clear")}}insertAtCaret(t){var e=Math.min(this.caretPos,this.items.length),i=this.buffer||this.control;0===e?i.insertBefore(t,i.firstChild):i.insertBefore(t,i.children[e]),this.setCaret(e+1)}deleteSelection(t){var e,i,s,n,o;if(e=t&&t.keyCode===v?-1:1,i={start:(o=this.control_input).selectionStart,length:o.selectionEnd-o.selectionStart},s=[],this.activeItems.length){n=N(D(this.activeItems,e)),e>0&&n++;for(const t of this.activeItems)s.push(t.dataset.value)}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(e<0&&0===i.start&&0===i.length?s.push(this.items[this.caretPos-1]):e>0&&i.start===this.inputValue().length&&s.push(this.items[this.caretPos]));if(!s.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete.call(this,s,t))return!1;for(_(t,!0),void 0!==n&&this.setCaret(n);s.length;)this.removeItem(s.pop());return this.showInput(),this.positionDropdown(),this.refreshOptions(!1),!0}advanceSelection(t,e){var i,s,n;this.rtl&&(t*=-1),this.inputValue().length||(S(O,e)||S("shiftKey",e)?(n=(s=this.getLastActive(t))?s.classList.contains("active")?this.getAdjacent(s,t,"item"):s:t>0?this.control_input.nextElementSibling:this.control_input.previousElementSibling)&&(n.classList.contains("active")&&this.removeActiveItem(s),this.setActiveItemClass(n)):this.isFocused&&!this.activeItems.length?this.setCaret(this.caretPos+t):(s=this.getLastActive(t))&&(i=N(s),this.setCaret(t>0?i+1:i),this.setActiveItem()))}getLastActive(t){let e=this.control.querySelector(".last-active");if(e)return e;var i=this.control.querySelectorAll(".active");return i?D(i,t):void 0}setCaret(t){var e=this;"single"===e.settings.mode||e.settings.controlInput?t=e.items.length:(t=Math.max(0,Math.min(e.items.length,t)))==e.caretPos||e.isPending||e.controlChildren().forEach((i,s)=>{s<t?e.control_input.insertAdjacentElement("beforebegin",i):e.control.appendChild(i)}),e.caretPos=t}controlChildren(){return Array.from(this.control.getElementsByClassName(this.settings.itemClass))}lock(){this.close(),this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){this.input.disabled=!0,this.control_input.disabled=!0,this.control_input.tabIndex=-1,this.isDisabled=!0,this.lock()}enable(){this.input.disabled=!1,this.control_input.disabled=!1,this.control_input.tabIndex=this.tabIndex,this.isDisabled=!1,this.unlock()}destroy(){var t=this.revertSettings;this.trigger("destroy"),this.off(),this.wrapper.remove(),this.dropdown.remove(),this.input.innerHTML=t.innerHTML,this.input.tabIndex=t.tabIndex,T(this.input,"tomselected"),this.input.removeAttribute("hidden"),this.input.required=this.isRequired,this._destroy(),delete this.input.tomselect}render(t,e){var i,s;if(("option"===t||"item"===t)&&(i=w(e[this.settings.valueField]),this.renderCache[t].hasOwnProperty(i)))return this.renderCache[t][i];var n=this.settings.render[t];return"function"!=typeof n?null:(s=n.call(this,e,I))?(s=F(s),"option"===t||"option_create"===t?e[this.settings.disabledField]?R(s,{"aria-disabled":"true"}):R(s,{"data-selectable":""}):"optgroup"===t&&(R(s,{"data-group":e.group[this.settings.optgroupValueField]}),e.group[this.settings.disabledField]&&R(s,{"data-disabled":""})),"option"!==t&&"item"!==t||(R(s,{"data-value":i}),"item"===t?E(s,this.settings.itemClass):(E(s,this.settings.optionClass),R(s,{role:"option",id:e.$id})),this.renderCache[t][i]=s),s):s}clearCache(t){void 0===t?this.renderCache={item:{},option:{}}:this.renderCache[t]={}}canCreate(t){return this.settings.create&&t.length&&this.settings.createFilter.call(this,t)}hook(t,e,i){var s=this,n=s[e];s[e]=function(){var e,o;return"after"===t&&(e=n.apply(s,arguments)),o=i.apply(s,arguments),"instead"===t?o:("before"===t&&(e=n.apply(s,arguments)),e)}}}return H.define("change_listener",function(t){var e=this,i=!1;A(e.input,"change",()=>{if(i)i=!1;else{i=!0;var t=k(e.input,{});e.setupOptions(t.options,t.optgroups),e.setValue(t.items)}})}),H.define("checkbox_options",function(t){var e=this,i=e.onOptionSelect;e.settings.hideSelected=!1;var s=function(t){var e=t.querySelector("input");t.classList.contains("selected")?e.checked=!0:e.checked=!1};e.hook("after","setupTemplates",()=>{var t=e.settings.render.option;e.settings.render.option=function(i){var s=F(t.apply(e,arguments)),n=document.createElement("input");n.addEventListener("click",function(t){_(t)}),n.type="checkbox";var o=w(i[e.settings.valueField]);return e.items.indexOf(o)>-1&&(n.checked=!0),s.prepend(n),s}}),e.on("item_remove",t=>{var i=e.getOption(t);i&&(i.classList.remove("selected"),s(i))}),e.hook("instead","onOptionSelect",function(t,s){return s.classList.contains("selected")?(s.classList.remove("selected"),e.removeItem(s.dataset.value),e.refreshOptions(),void _(t,!0)):i.apply(e,arguments)}),e.hook("after","onOptionSelect",(t,e)=>{s(e)})}),H.define("clear_button",function(t){var e=this;t=Object.assign({className:"clear-button",title:"Clear All",html:t=>`<div class="${t.className}" title="${t.title}">&times;</div>`},t),e.hook("after","setup",()=>{var i=F(t.html(t));i.addEventListener("click",t=>{for(;e.items.length>0;)e.removeItem(e.items[0],!0);e.updateOriginalInput(),t.preventDefault(),t.stopPropagation()}),e.control.appendChild(i)})}),H.define("drag_drop",function(t){var e=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===e.settings.mode){var i=e.lock,s=e.unlock;e.hook("instead","lock",function(){var t=e.control.dataset.sortable;return t&&t.disable(),i.apply(e,arguments)}),e.hook("instead","unlock",function(){var t=e.control.dataset.sortable;return t&&t.enable(),s.apply(e,arguments)}),e.hook("after","setup",()=>{var t=$(e.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:e.isLocked,start:(e,i)=>{i.placeholder.css("width",i.helper.css("width")),t.css({overflow:"visible"})},stop:()=>{t.css({overflow:"hidden"});var i=[];t.children("[data-value]").each(function(){i.push($(this).attr("data-value"))}),e.setValue(i)}})})}}),H.define("dropdown_header",function(t){var e=this;t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:t=>'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a class="'+t.closeClass+'">&times;</a></div></div>'},t),e.hook("after","setup",()=>{var i=F(t.html(t)),s=i.querySelector("."+t.closeClass);s&&s.addEventListener("click",t=>{_(t,!0),e.close()}),e.dropdown.insertBefore(i,e.dropdown.firstChild)})}),H.define("dropdown_input",function(){var t=this,e=t.settings.controlInput||'<input type="text" autocomplete="off" class="dropdown-input" />';e=F(e),t.settings.placeholder&&R(e,{placeholder:t.settings.placeholder}),t.settings.controlInput=e,t.settings.shouldOpen=!0,t.hook("after","setup",()=>{R(t.wrapper,{tabindex:t.input.disabled?"-1":t.tabIndex}),A(t.wrapper,"keypress",e=>{if(!t.control.contains(e.target)&&!t.dropdown.contains(e.target))switch(e.keyCode){case d:return void t.onClick(e)}});let i=F('<div class="dropdown-input-wrap">');i.appendChild(e),t.dropdown.insertBefore(i,t.dropdown.firstChild)})}),H.define("input_autogrow",function(){var t=this;t.hook("after","setup",()=>{var e=document.createElement("span"),i=t.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",t.wrapper.appendChild(e);for(const t of["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"])e.style[t]=i.style[t];var s=()=>{t.items.length>0?(e.textContent=i.value,i.style.width=e.clientWidth+"px"):i.style.width=""};s(),t.on("update item_add item_remove",s),A(i,"input",s),A(i,"keyup",s),A(i,"blur",s),A(i,"update",s)})}),H.define("no_backspace_delete",function(){var t=this,e=t.deleteSelection;this.hook("instead","deleteSelection",function(){return!!t.activeItems.length&&e.apply(t,arguments)})}),H.define("no_active_items",function(t){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}),H.define("optgroup_columns",function(){var t=this,e=t.onKeyDown;t.hook("instead","onKeyDown",function(i){var s,n,o,r;if(!t.isOpen||i.keyCode!==c&&i.keyCode!==g)return e.apply(t,arguments);r=j(t.activeOption,"[data-group]"),s=N(t.activeOption,"[data-selectable]"),(r=i.keyCode===c?r.previousSibling:r.nextSibling)&&(n=(o=r.querySelectorAll("[data-selectable]"))[Math.min(o.length-1,s)])&&t.setActiveOption(n)})}),H.define("remove_button",function(t){t=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},t);var e=this;if(t.append){var i='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+I(t.title)+'">'+t.label+"</a>";e.hook("after","setupTemplates",()=>{var t=e.settings.render.item;e.settings.render.item=function(){var s=F(t.apply(e,arguments)),n=F(i);return s.appendChild(n),A(n,"mousedown",t=>{_(t,!0)}),A(n,"click",t=>{if(_(t,!0),!e.isLocked){var i=s.dataset.value;e.removeItem(i),e.refreshOptions(!1)}}),s}})}}),H.define("restore_on_backspace",function(t){var e=this;t.text=t.text||function(t){return t[e.settings.labelField]},e.on("item_remove",function(i){if(""===e.control_input.value.trim()){var s=e.options[i];s&&e.setTextboxValue(t.text.call(e,s))}})}),H});var tomSelect=function(t,e){return new TomSelect(t,e)};
